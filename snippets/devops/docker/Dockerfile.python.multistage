# syntax=docker/dockerfile:1
FROM python:3.11-slim AS base
WORKDIR /app
RUN useradd -m appuser

FROM base AS deps
COPY pyproject.toml poetry.lock* ./
RUN pip install poetry && poetry config virtualenvs.create false && poetry install --only main

FROM base AS runtime
COPY --from=deps /usr/local/lib/python3.11 /usr/local/lib/python3.11
COPY . .
USER appuser
CMD ["python", "-m", "app"]